{% extends 'base.html' %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/search.css') }}">
<title>Fakebook - Search</title>
{% endblock %}

{% block body %}

 <!-- Community Header -->
 <div class="community-header">
    <h1>Fakebook Community</h1>
</div>

<!-- Search Bar -->
<div class="search-container">
    <form action="/search/profiles" method="get" autocomplete="off">
        <input type="text" id="search-input" placeholder="Search for users..." name="query" class="search-input">
        <button type="submit" class="search-btn">Search</button>
    </form>

    <!-- Search Results -->
    <div class="suggestions-box" id="suggestions"></div>
</div>

<script>
    function handleSearch(event) {
        event.preventDefault();

        var query = this.value.trim();  // Trim whitespace
        if (query.length > 0) {
            fetch('/search/suggestions?query=' + encodeURIComponent(query))
                .then(response => response.json())
                .then(data => {
                    var suggestionsBox = document.getElementById('suggestions');
                    suggestionsBox.innerHTML = '';
                    suggestionsBox.style.display = 'block';

                    if (data.length === 0) {
                        suggestionsBox.innerHTML = '<div class="suggestion-item">No results found</div>';
                    } else {
                        data.forEach(function(item) {
                            var div = document.createElement('div');
                            div.className = 'suggestion-item';
                            div.textContent = item.username;
                            div.addEventListener('click', function() {
                                document.getElementById('search-input').value = item.username;
                                suggestionsBox.innerHTML = '';
                                suggestionsBox.style.display = 'none';
                            });
                            suggestionsBox.appendChild(div);
                        });
                    }
                })
                .catch(error => console.error('Error fetching suggestions:', error));
        } else {
            document.getElementById('suggestions').style.display = 'none';
        }
    }
    document.getElementById('search-input').addEventListener('input', handleSearch);
</script>
{% endblock %}
